name: Approval Waiting Roomba

on:
  workflow_call:
  push:
    branches:
      - roomba

concurrency: roomba_workflow

jobs:
  Cleanup-Time:
    runs-on: ubuntu-latest
    steps:
      - run: echo "Cleaning up earlier workflows that is still waiting for approval ðŸ§¹"
      - name: Retrieve earlier workflows that are still pending review
        uses: actions/github-script@v6
        with:
          script: |
            const response = await github.rest.actions.listWorkflowRunsForRepo({
              owner: context.repo.owner,
              repo: context.repo.repo,
              status: "waiting"
            })
            console.log(Object.keys(response.data))
            console.log(Object.keys(response.data.total_count))
            console.log(Object.keys(response.data.workflow_runs[0]))

            const currentRunNumberAsString = ${{github.run_number}}
            const currentRunNumber = parseInt(currentRunNumberAsString)
            console.log(`currentRunNumber: ${currentRunNumber}`)

            const earlier_workflows = response.data.workflow_runs.filter(run => {
              console.log(${{github.workflow}})
              console.log(run.workflow_id.toString())
              console.log(run.run_number)

              return run
            })

            console.log(`Found ${earlier_workflows.length} earlier workflows still pending.`)
